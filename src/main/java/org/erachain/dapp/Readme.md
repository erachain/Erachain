# DAPP (Smartcontracts, Децентрализованное Приложение)

В Эрачейн можно делать свои цифровые распределенные приложения (dAPP,смартконтракты). Основное отличие от
смартконтрактов в других блокчейн - вам доступны все данные среды и ее возможности, а не только те, что находятся внутри
смарт-контракта. Поэтому на Erachain-DAPPs можно делать целые игры или сложные приложения.

Но есть и ограничение: для того чтобы ваш DAPP заработал, нужно его выложить в код ноды и обносить всю сеть. Таким
образом мы действительно распределенное приложение, которое доступно всем одинаково.

Для удобства написания своих Приложений есть уже готовые Шаблоны:

- epoch.EpochDAPP. Основной класс
- EpochDAPPjson.java. Расширенный - в сообщении управляющей транзакции ожидается JSON с командами и значениями.
  Например ["set price",{"1": {"2":"0.1","18":2}}]

Все смартконтаты имеют свой уникальный ID, из которого создается уникальный публичный ключ и счет. Заметьте что
приватного ключа у Приложения нет - так как оно полностью децентрализовано. Поэтому на счет Приложения нельзя посылать
зашифрованные сообщения. Вернее модно, но Приложение их не сможет расшифровать. Так же вы можете создать любое число
счетов для данного Приложения (просто прибавляйте число к ID и генерируйте новый публичный ключ)

Обычно любая транзакцияЮ посланная на счет смартконтракта активирует его. И если вы задали нужные действия на нужную
транзакцию, то он исполнится.

Так же у Приложений есть свои активы, которые они могут сгенерироваться в момент его инициализации или во время своей
работы. Пересылка таких активов на счет Приложения так же запускает действие.

### Примеры уже готовых DAPP

- Refi.java - это готовая многоуровневая реферальная система
- LeafFall.java - "магический листопад". Это простая игра по выпадению осенних листьев в ответ на посланные на счет
  Приложения транзакции. Можно развить ее дальше - для сборки гербариев. Листья имеют редкость выпадения.
- DogePlanet.java - "Планеты DOGE". Недоделанная игра. Пока реализовано выпадение разных по редкости и выиду частей
  планет и комет - из которых можно собирать полные планеты. Идея игры была по созданию вселенной на планетах и
  путешествиях + боях планет.
- ShibaVerseDAPP.java - расширенная версия DogePlanet - с целым магазином вещей внутри. Со сложной системой редкостей и
  характеристик
- MemoCardsDAPP.java - так же с магазином внутри и с продажей "бустеров". При раскрытии которых выпадают случайные по
  редкости и свойствам игровые карты для игры в коллекционные карточки типа "Magic The Gathering"
- Voucher (реализовано в FOILNetwork) - "Красный конверт" - подарок как у китайцев, в который можно положить любое число
  денег, активов, запаковать и продавать передавать дарить одним конвертом. А потом его раскрыть и вытащить всё.

Тут надо заметить что случайность срабатывает "из будущего" - через несколько блоков (как зададите в своем Приложении) -
так что никто его угадать не может.

## Встраивание в среду

Созданное Приложение помещаем в папку сюда (java/org/erachain/dapp/epoch), И вносим нужный код в фабрику Приложений -
dapp.DAPPFactory:

1. рядом с ShibaVerseDAPP.setDAPPFactory(stocks); - если есть счета для хранения активов в Приложении
2. и в dapp.DAPPFactory.make - где нужно чтобы Приложение активировалось на заданную транзакцию. Или использовать
   стандартный вызов рядом в другими Приложениями:

``` java
    case Refi.ID:
        return Refi.make(txSend, dataStr);
```

3. и в getName() внести
4.

## Медиа-файлы Приложения

Можно положить нужные файлы в папку проекта, но это не рекомендуется. Лучше всего:

1. медиа-файлы внести как Активы (документы) в блокчейн оычным ручным образом и сделать внутри Приложения ссылки на эти
   активы по уникальным номерам.
2. сделать инициализацию Приложения (по особой первой команде), при котором само приложение создает нужные медиа-файлы

Внести особые вызовы для генерации картинок в код активов core.item.assets.AssetUnique.getImageURL, например так:

``` java
        if (maker.equals(DogePlanet.MAKER))
            return DogePlanet.getImageURL(this);
```

и задать свой код аналогично dapp.epoch.DogePlanet.getImageURL

Так же и для иконок или описаний.

Кстати у активов DogePlanet реализован массив накладывающихся картинок (с прозрачным фоном), которые генерят случайную
планету из Фон, Тело, Мордочка, Хвост, Ушки, Спутник

Дополнительные обработчики - по блокам. Вставляем нужный код сюда dapp.DAPP.processByBlock:

``` java
    public static void processByBlock(DCSet dcSet, Block block, boolean asOrphan) {
        ShibaVerseDAPP.blockAction(dcSet, block, asOrphan);
    }
```

Не забываем вставить парсинг в dapp.DAPP.Parses

Вообще чтобы понять где нужно вставить код cвоего Приложения, делаем поиск по всему коду например `ShibaVerseDAPP`

 

